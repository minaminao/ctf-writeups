# Writeup for size limit

次の Python スクリプトと、その出力ファイルが与えられます。

```python
from Crypto.Util.number import getPrime, bytes_to_long
import flag 

assert(len(flag.flag) == 131)

p = getPrime(512)
q = getPrime(512)
N = p * q
phi = (p - 1) * (q - 1)
e = 0x10001
d = pow(e, -1, phi)

flag = bytes_to_long(flag.flag)


c = pow(flag, e, N)

print(f'N = {N}')
print(f'e = {e}')
print(f'c = {c}')
print(f'd = {d}')
```

RSA で暗号化しています。

`d` も与えられているので、普通であれば `pow(c, d, N)` で平文が求まります。

しかし、フラグ長が 131 バイト = 1048 ビットとなっており、これは `N` の 1024 ビットよりも大きい値なので、単純には求まりません。

冗長ですが、 `flag` を $m$ として、 $m' = m \bmod N$ とすると、

$$c \equiv m'^e \pmod N$$

であり、

$$m' \equiv c^d \pmod N$$

であることから、 $m'$ は求まります。

$k$ を定数として、 $m = m' + kN$ の関係があることから、この $k$ を全探索してフラグとなるような文字列になるかを見れば良さそうです。

オーバーしているのは 24 ビット程度であり、計算量的に全探索が余裕です。

```python
from Crypto.Util.number import long_to_bytes

N = 65667982563395257456152578363358687414628050739860770903063206052667362178166666380390723634587933595241827767873104710537142458025201334420236653463444534018710274020834864080096247524541536313609304410859158429347482458882414275205742819080566766561312731091051276328620677195262137013588957713118640118673
e = 65537
c = 58443816925218320329602359198394095572237417576497896076618137604965419783093911328796166409276903249508047338019341719597113848471431947372873538253571717690982768328452282012361099369599755904288363602972252305949989677897650696581947849811037791349546750246816657184156675665729104603485387966759433211643
d = 14647215605104168233120807948419630020096019740227424951721591560155202409637919482865428659999792686501442518131270040719470657054982576354654918600616933355973824403026082055356501271036719280033851192012142309772828216012662939598631302504166489383155079998940570839539052860822636744356963005556392864865

m = pow(c, d, N)

for _ in range(1 << 25):
    m += N
    x = long_to_bytes(m)
    if b"TSGLIVE" in x:
        print(x)
        break
```

これでフラグが求まりました。

Flag: `TSGLIVE{Tttthhhhhiiiiiiisssss iiiiiiiiiisssss aaaaaaaaaaaaaa tooooooooooooooooooooo looooooooooooooooong fllllaaaaaaaaaaaaaaaaaag!}`
